{% extends "base.html" %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/transfers.css') }}" media="screen" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/transfers.js') }}" type="text/javascript"></script>
{% endblock %}

{% block content %}
<div id="overlay_trigger" rel="#add_overlay"></div>

<div class="content_form content_color">
    <form>
        <p class="title">Add a transfer</p>
        <input type="text" name="src" size="30" value="" />
        to <input type="text" name="dst" size="30" value="" />
        <select title="type" name="type">
            <option value="">auto</option>
            <option value="torrent">torrent</option>
        </select>
        <button class="button" type="submit" value="add">add</button>
    </form>
</div>

{% for item in items %}
    <div class="content_element content_color">

        <form>
            <table class="element_name">
                <tr>
                    <input type="hidden" name="id" value="{{ item._id }}" />

                    <td style="width: auto;">
                        <span class="name"></span>
                        <div class="progressbox">
                            <div class="progress">
                                <div class="progressbar"></div>
                            </div>
                        </div>
                    </td>

                    {% if item.search_id %}
                        <td class="td_button">
                            <a href="{{ url_for('searches', id=item.search_id) }}"><img class="img_button" src="{{ url_for('static', filename='img/info.png') }}"></img></a>
                        </td>
                    {% endif %}

                    <td class="td_button">
                        <a href=""><img class="img_button" src="{{ url_for('static', filename='img/more.png') }}" alt="more"></img></a>
                    </td>
                    <td class="td_button">
                        <a href=""><img class="img_button" src="{{ url_for('static', filename='img/remove.png') }}" alt="remove"></img></a>
                    </td>
                </tr>
            </table>
        </form>

        <div class="element_more" style="display: none;">
            <table>
                {% for key, val in [('Type', item.type), ('Created', item.created), ('Started', item.started), ('Source', item.src|truncate(80, True)), ('Destination', item.dst)] %}
                    <tr>
                        <td class="details_title">{{ key }}:</td><td>{% if val != None %}{{ val }}{% else %}-{% endif %}</td>
                    </tr>
                {% endfor %}

                <tr>
                    <td class="details_title">Transferred:</td><td><span class="transferred"></span> MB</td>
                </tr>
                <tr>
                    <td class="details_title">Size:</td><td><span class="size"></span> MB</td>
                </tr>
                <tr>
                    <td class="details_title">Progress:</td><td><span class="progress"></span> %</td>
                </tr>

                {% for key, val in [('Hash', item.info.hash), ('Status', item.info.status), ('Last activity', item.info.date_active), ('Download directory', item.info.download_dir)] %}
                    <tr>
                        <td class="details_title">{{ key }}:</td><td>{% if val %}{{ val }}{% else %}-{% endif %}</td>
                    </tr>
                {% endfor %}
                {% if item.info.transfer_rate %}
                    <tr>
                        <td class="details_title">Download rate:</td><td>{{ (item.info.transfer_rate / 1024)|int }} KB/s</td>
                    </tr>
                {% endif %}
                {% if item.info.files %}
                    <tr>
                        <td class="details_title">Files:</td><td></td>
                    </tr>
                    {% for file in item.info.files|sort %}
                        <tr>
                            <td></td><td>{{ file }}</td>
                        </tr>
                    {% endfor %}
                {% endif %}

                {% if item.info.error_string %}
                    <tr>
                        <td class="details_title"><p class="title">Error:</p></td><td>{{ item.info.error_string }}</td>
                    </tr>
                {% endif %}

            </table>
        </div>

    </div>
{% endfor %}

{% endblock %}
